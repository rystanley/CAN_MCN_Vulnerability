#load libraries ---- 
library(dplyr)
library(ggplot2)
library(sf)
library(tidyr)
library(lsmeans)
library(emmeans)
library(rnaturalearth)
library(broom)

sf_use_s2(FALSE)

#Projections ------------
latlong <- "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
CanProj <- "+proj=lcc +lat_1=49 +lat_2=77 +lat_0=63.390675 +lon_0=-91.86666666666666 +x_0=6200000 +y_0=3000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"

#load data -----
##load data from the overlay analysis - 02_overlay_analysis.R ----
load("output/bioregion_extract.RData") #extracts of the entire bioregions
load("output/can_network_extract.RData") #extracts from the Canadian Marine Conservation Network - inside and outside within each bioregion
load("output/mar_network_extract.RData") #extracts from the Scotian Shelf-Bay of Fundy Draft Network - inside and outside the Maritimes region

#load polygons ----- 
#using the polygon_load function - this load polygons for each function instead of re-writing the code multiple times. Makes things more consistent. 
source("code/polygon_load.R")
polygon_load()

#Plotting levels ----
ocean_ord <- c("Pacific","Arctic","Atlantic")
rcp_ord <- c("RCP 8.5","RCP 2.6")

can_bioregions_centroids <- can_bioregions%>%
  st_centroid()%>%
  st_transform(latlong)%>%
  mutate(lat = st_coordinates(.)[,2],
         ocean = factor(ocean,levels=ocean_ord))%>%
  data.frame()%>%
  arrange(ocean,lat) #arrange them by latitude (centroid) within each bioregion

bioregion_ord <- can_bioregions_centroids%>%pull(region)

mpa_ord <- can_mcn_regions%>%
  mutate(region=factor(region,levels=bioregion_ord))%>%
  arrange(region,clat)%>%pull(NAME_E) #arrange them by latitude (centroid) within each bioregion

#Load plotting abbreviations and set levels for the plotting dataframes
mpa_abbreviations <- read.csv("data/mpa_abbreviations.csv")
region_abbreviations <- read.csv("data/region_abbreviations.csv")
mcn_abbreviations <- read.csv("data/mcn_abbreviations.csv") #these are ones that I made up quickly for every type of closure in the Canadian MCN
mar_abbreviations <- read.csv("data/mar_draft_network_abbreviations.csv")%>%arrange(group,lat) #these are the ones used by Lewis et al. arraged by group and latitute 

#merge in the abbreviations with the extracts and set plotting levels
bioregion_df <- bioregion_extract%>%
  left_join(.,region_abbreviations)%>%
  mutate(region=factor(region,levels=bioregion_ord),
         rcp=ifelse(rcp==2.6,"RCP 2.6","RCP 8.5"),
         rcp=factor(rcp,levels=rcp_ord)) 

can_mcn_df <- can_mcn_extracts%>%
  left_join(.,mcn_abbreviations)%>%
  mutate(name=factor(NAME_E,levels=mpa_ord),
         region=factor(region,levels=bioregion_ord),
         ocean=factor(ocean,levels=ocean_ord),
         rcp=ifelse(rcp==2.6,"RCP 2.6","RCP 8.5"),
         rcp=factor(rcp,levels=rcp_ord))

mar_network_df <- mar_network_extract%>%
  left_join(.,mar_abbreviations%>%dplyr::select(-c(long,lat)))%>%
  mutate(name = factor(mar_name,levels = mar_abbreviations%>%pull(abbreviation)),
         rcp=ifelse(rcp==2.6,"RCP 2.6","RCP 8.5"),
         rcp=factor(rcp,levels=rcp_ord)) 


#Statistical Tests ------------

bioregions <- can_mcn_df%>%
  filter(!region%in%c("Arctic Archipelago","Hudson Bay Complex","Southern Shelf"))%>% #these only have 'outside' since no PAs are present within extent
  pull(region)%>%
  as.character()%>%
  unique()

fit_extracts <- NULL
fit_summaries <- NULL
model_envs <- NULL
for(i in bioregions){  
  
  message(paste0("Working on ",i))                
  
  #Model - does vulnerability vary between inside/outside and RCP scenarios - is the difference contingent on rcp? 
  fit <- aov(vuln ~ location*rcp,                                     
             data=can_mcn_extracts%>%data.frame()%>%filter(region==i),
             weights = cell_area) #made this one because the mcn_df one was not coorperating, put rcp as continous but it's the same data
  
  #fit <- aov(vuln ~ location*rcp,                                     
             #data=can_mcn_df%>%data.frame()%>%filter(region==i),
            # weights = cell_area)
  
  fit_extracts <- emmip(fit,rcp~location,CIs = TRUE)$data%>% 
    data.frame()%>%
    mutate(region=i)%>%
    rbind(.,fit_extracts)
  
  fit_summaries <- tidy(fit)%>%
    mutate(region=i)%>%
    rbind(.,fit_summaries)
  
  model_envs[[i]] <- fit
}
# for the oceans -----------------------------------
oceans <- c("Arctic", "Atlantic", "Pacific")

for(i in ocean_ord){  
  
  message(paste0("Working on ",i))                
  
  #Model - does vulnerability vary between inside/outside and RCP scenarios - is the difference contingent on rcp? 
  fit <- aov(vuln ~ location*rcp,                                     
             data=can_mcn_extracts%>%data.frame()%>%filter(ocean==i)) #made this one because the mcn_df one was not coorperating, put rcp as continous but it's the same data
  
  #fit <- aov(vuln ~ location*rcp,                                     
            # data=can_mcn_df%>%data.frame()%>%filter(ocean==h),
           #  weights = cell_area)
  
  fit_extracts <- emmip(fit,rcp~location,CIs = TRUE)$data%>% 
    data.frame()%>%
    mutate(ocean=i)%>%
    rbind(.,fit_extracts)
  
  fit_summaries <- tidy(fit)%>%
    mutate(ocean=i)%>%
    rbind(.,fit_summaries)
  
  model_envs[[i]] <- fit
}
#----------------------------------------------------
#see the model parameter estimates
mod_fits <- ggplot(data=fit_extracts,aes(x=location,y=yvar,col=rcp))+
  geom_point()+
  geom_errorbar(aes(ymin=LCL,ymax=UCL),width=0.2)+ #there are the confidence internals from the within region tests
  geom_line(aes(group=rcp))+
  facet_wrap(~region,ncol=3,scales="free")+
  theme_bw()+
  theme(strip.background = element_rect(fill="white"),
        legend.position = "bottom")+
  labs(x="",y="Vulnerability",col="")

ggsave("output/model_fitplot.png",mod_fits,height=6,width=6,units="in",dpi=300)

#see whether the influence of 'inside' and 'outside' is contingent on the RCP scenario (e.g., is the difference different between emissions scenarios)
sig <- fit_summaries%>%filter(term=="location:rcp")%>%mutate(pval=round(as.numeric(p.value),4))
#only in the Arctic does the emissions scenario temper the difference between inside and outside. 

#you can explore the plot fits using this syntax
plot(model_envs[["Northern Shelf"]])
plot(model_envs[["Scotian Shelf"]])
plot(model_envs[["Western Arctic"]])
plot(model_envs[["Eastern Arctic"]])
plot(model_envs[["Gulf of Saint Lawrence"]])
plot(model_envs[["Strait of Georgia"]])
plot(model_envs[["Offshore Pacific"]])
plot(model_envs[["Arctic Basin"]])
plot(model_envs[["Newfoundland-Labrador Shelves"]])



## compare the model fitted intervals to that derived directly from the data
ci_df <- can_mcn_df%>%
         data.frame()%>%
         filter(!is.na(vuln))%>% #get rid of any NA values
         group_by(rcp,region,location)%>%
         summarise(mn=mean(vuln),
                   ci_range=sd(vuln)/sqrt(n()),
                   ucl=mn+ci_range,
                   lcl=mn-ci_range)%>%
         ungroup()%>%
         data.frame()%>%
         dplyr::select(-ci_range)%>%
         mutate(type="data extract")

combo_df <- fit_extracts%>%
            filter(region %in% unique(ci_df$region))%>%
            dplyr::select(rcp,region,location,yvar,LCL,UCL)%>%
            rename(mn=yvar,ucl=UCL,lcl=LCL)%>%
            mutate(type="model extract")%>%
            rbind(.,ci_df)


  ggplot(data=combo_df%>%filter(rcp=="RCP 2.6"),aes(x=location,y=mn,col=type))+
  geom_point()+
  geom_errorbar(aes(ymin=lcl,ymax=ucl),width=0.2,position = "dodge2")+ #there are the confidence internals from the within region tests
  geom_line(aes(group=type))+
  facet_wrap(~region,ncol=3,scales="free")+
  theme_bw()+
  theme(strip.background = element_rect(fill="white"),
        legend.position = "bottom")+
  labs(x="",y="Vulnerability Â± 95% CI",col="")
  
  
  
  #testing different models---------------------------- lowest AIC value shows that interaction model is the best model (rcp*location instead of rcp+location)
 
  fit_extracts <- NULL
  fit_summaries <- NULL
  model_envs <- NULL
  for(i in bioregions){  
    
    message(paste0("Working on ",i))                
    
    #Model - does vulnerability vary between inside/outside and RCP scenarios - is the difference contingent on rcp? 
    two.way <- aov(vuln ~ location+rcp,                                     
               data=can_mcn_extracts%>%data.frame()%>%filter(region==i),
               weights = cell_area) #made this one because the mcn_df one was not coorperating, put rcp as continous but it's the same data
    
    fit_extracts <- emmip(fit,rcp~location,CIs = TRUE)$data%>% 
      data.frame()%>%
      mutate(region=i)%>%
      rbind(.,fit_extracts)
    
    fit_summaries <- tidy(fit)%>%
      mutate(region=i)%>%
      rbind(.,fit_summaries)
    
    model_envs[[i]] <- fit
  }
  
  fit_extracts <- NULL
  fit_summaries <- NULL
  model_envs <- NULL
  for(i in bioregions){  
    
    message(paste0("Working on ",i))                
    
    #Model - does vulnerability vary between inside/outside and RCP scenarios - is the difference contingent on rcp? 
   interactions <- aov(vuln ~ location*rcp,                                     
               data=can_mcn_extracts%>%data.frame()%>%filter(region==i),
               weights = cell_area) #made this one because the mcn_df one was not coorperating, put rcp as continous but it's the same data
    
    #fit <- aov(vuln ~ location*rcp,                                     
    #data=can_mcn_df%>%data.frame()%>%filter(region==i),
    # weights = cell_area)
    
    fit_extracts <- emmip(fit,rcp~location,CIs = TRUE)$data%>% 
      data.frame()%>%
      mutate(region=i)%>%
      rbind(.,fit_extracts)
    
    fit_summaries <- tidy(fit)%>%
      mutate(region=i)%>%
      rbind(.,fit_summaries)
    
    model_envs[[i]] <- fit
  }
  
  library(AICcmodavg)
  
  model.set <- list(two.way, interactions)
  model.names <- c("two.way", "interactions")
  
  aictab(model.set, modnames = model.names)
  
#assumptions of the model
  #homoscedasticity
  plot(model_envs[["Northern Shelf"]]) #meets it, lines horizontal (scale-location a little weird)
  plot(model_envs[["Scotian Shelf"]]) #residuals vs leverage is not great, qq not great
  plot(model_envs[["Western Arctic"]]) #meets it, lines horizontal
  plot(model_envs[["Eastern Arctic"]]) #meets it, lines horizontal
  plot(model_envs[["Gulf of Saint Lawrence"]]) #meets it, lines horizontal
  plot(model_envs[["Strait of Georgia"]]) #scale-location is a bit off, residuals vs leverage a little weird
  plot(model_envs[["Offshore Pacific"]]) #qq not great, all others meet it
  plot(model_envs[["Arctic Basin"]]) #meets it, lines horizontal
  plot(model_envs[["Newfoundland-Labrador Shelves"]]) #residuals vs leverage a little weird, all otehrs meet it
  
  #Post hoc comaprison--
  #using Tukey's Honestly Significant Difference
  
  #inside/outside
  for(i in bioregions){  
  
  interactions <- aov(vuln ~ location*rcp,                                     
                        data=can_mcn_extracts%>%data.frame()%>%filter(region==i),
                        weights = cell_area)
  
  tukey.interactions[i] <- TukeyHSD(interactions, which='location')
  
  print(tukey.interactions)
  }
 
   #rcp
  for(i in bioregions){  
    
    interactions <- aov(vuln ~ location*rcp,                                     
                        data=can_mcn_extracts%>%data.frame()%>%filter(region==i),
                        weights = cell_area)
    
    tukey.interactions[i] <- TukeyHSD(interactions, which='rcp')
    
    print(tukey.interactions)
  }
  # new plan ------------------- make one comparison table for each bioregion (maybe tukey, maybe t-test?)---------------------------------------------------------
  # RCP 2.6 IN-RCP 2.6 IN - expect no difference
  # [DONE] RCP 2.6 IN-RCP 2.6 OUT - if *** then MCN matters at RCP 2.6
  # RCP 2.6 IN-RCP 8.5 IN - if *** then RCP matters in MCN
  # RCP 2.6 IN-RCP 8.5 OUT - expect will always be *** (both combined matter? interpretation unclear)
  # RCP 2.6 OUT-RCP 8.5 IN - if *** then ????
  # [DONE] RCP 8.5 IN-RCP 8.5 OUT - if *** then MCN matters at RCP 8.5
  # RCP 2.6 OUT-RCP 8.5 OUT - if *** then RCP matters outside MCN
  
# ---------------------------------------------OCEANS--------------------------------------------------  
# ARCTIC -------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0 < 0.05, so significant (***), MCN matters for 2.6
  interactions_arctic <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(ocean=="Arctic", rcp=="2.6"),
                         weights = cell_area)
  
  tukey.interaction_arctic_2.6 <- TukeyHSD(interactions_arctic, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p= 0 < 0.05, so significant (***), MCN matters for 8.5
  interactions_arctic <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(ocean=="Arctic", rcp=="8.5"),
                         weights = cell_area)
  
  tukey.interaction_arctic_8.5 <- TukeyHSD(interactions_arctic, which='location')
  
  print(tukey.interaction_arctic_2.6)
  print(tukey.interaction_arctic_8.5)
  
# ATLANTIC-----
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0 < 0.05, so significant (***), MCN matters for 2.6
  interactions_atlantic <- aov(vuln ~ location*rcp,                                     
                             data=can_mcn_extracts%>%data.frame()%>%filter(ocean=="Atlantic", rcp=="2.6"),
                             weights = cell_area)
  
  tukey.interaction_atlantic_2.6 <- TukeyHSD(interactions_atlantic, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p= 0 < 0.05, so significant (***), MCN matters for 8.5
  interactions_arctic <- aov(vuln ~ location*rcp,                                     
                             data=can_mcn_extracts%>%data.frame()%>%filter(ocean=="Atlantic", rcp=="8.5"),
                             weights = cell_area)
  
  tukey.interaction_atlantic_8.5 <- TukeyHSD(interactions_atlantic, which='location')
  
  print(tukey.interaction_atlantic_2.6)
  print(tukey.interaction_atlantic_8.5)
# PACIFIC-----
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0 < 0.05, so significant (***), MCN matters for 2.6
  interactions_pacific <- aov(vuln ~ location*rcp,                                     
                             data=can_mcn_extracts%>%data.frame()%>%filter(ocean=="Pacific", rcp=="2.6"),
                             weights = cell_area)
  
  tukey.interaction_pacific_2.6 <- TukeyHSD(interactions_pacific, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p= 0 < 0.05, so significant (***), MCN matters for 8.5
  interactions_pacific <- aov(vuln ~ location*rcp,                                     
                             data=can_mcn_extracts%>%data.frame()%>%filter(ocean=="Pacific", rcp=="8.5"),
                             weights = cell_area)
  
  tukey.interaction_pacific_8.5 <- TukeyHSD(interactions_pacific, which='location')
  
  print(tukey.interaction_pacific_2.6)
  print(tukey.interaction_pacific_8.5)
  
  
# -------------------------------------------BIOREGIONS-----------------------------------------------
# ARCTIC BASIN ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0 < 0.05, so significant (***), MCN matters for 2.6
  interactions_AB <- aov(vuln ~ location*rcp,                                     
                          data=can_mcn_extracts%>%data.frame()%>%filter(region=="Arctic Basin", rcp=="2.6"),
                          weights = cell_area)
  
  tukey.interaction_AB_2.6 <- TukeyHSD(interactions_AB, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p= 0 < 0.05, so significant (***), MCN matters for 8.5
  interactions_AB <- aov(vuln ~ location*rcp,                                     
                          data=can_mcn_extracts%>%data.frame()%>%filter(region=="Arctic Basin", rcp=="8.5"),
                          weights = cell_area)
  
  tukey.interaction_AB_8.5 <- TukeyHSD(interactions_AB, which='location')
  
  print(tukey.interaction_AB_2.6)
  print(tukey.interaction_AB_8.5)
  
  # RCP 2.6 IN-RCP 8.5 IN - p = 0 < 0.05, so significant (***), RCP matters for IN
  interactions_AB <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Arctic Basin", location=="outside"),
                         weights = cell_area)
  
  tukey.interaction_AB_IN <- TukeyHSD(interactions_AB, which='rcp')
 
  #unique(can_mcn_extracts$location) shows there are two factors, inside and outside, 
  #but I get an error message: contrasts can be applied only to factors with 2 or more levels. I can physically see in the data multiple variables though...
  
# EASTERN ARCTIC ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0 < 0.05, so significant (***), MCN matters for 2.6
  interactions_EA <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Eastern Arctic", rcp=="2.6"),
                         weights = cell_area)
  
  tukey.interaction_EA_2.6 <- TukeyHSD(interactions_EA, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p = 0 < 0.05, so significant (***), MCN matters for 8.5
  interactions_EA <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Eastern Arctic", rcp=="8.5"),
                         weights = cell_area)
  
  tukey.interaction_EA_8.5 <- TukeyHSD(interactions_EA, which='location')
  
  print(tukey.interaction_EA_2.6)
  print(tukey.interaction_EA_8.5)
  
# GULF OF SAINT LAWRENCE ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0.5008 > 0.05, so not significant, MCN doesn't matter for 2.6
  interactions_GoSL <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Gulf of Saint Lawrence", rcp=="2.6"),
                         weights = cell_area)
  
  tukey.interaction_GoSL_2.6 <- TukeyHSD(interactions_GoSL, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p = 0.5734 > 0.05, so not significant, MCN doesn't matter for 8.5
  interactions_GoSL <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Gulf of Saint Lawrence", rcp=="8.5"),
                         weights = cell_area)
  
  tukey.interaction_GoSL_8.5 <- TukeyHSD(interactions_GoSL, which='location')
  
  print(tukey.interaction_GoSL_2.6)
  print(tukey.interaction_GoSL_8.5)
  
# NL-SHELVES ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0 < 0.05, so significant (***), MCN matters for 2.6
  interactions_NL <- aov(vuln ~ location*rcp,                                     
                           data=can_mcn_extracts%>%data.frame()%>%filter(region=="Newfoundland-Labrador Shelves", rcp=="2.6"),
                           weights = cell_area)
  
  tukey.interaction_NL_2.6 <- TukeyHSD(interactions_NL, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p = 0 < 0.05, so significant (***), MCN matters for 8.5
  interactions_NL <- aov(vuln ~ location*rcp,                                     
                           data=can_mcn_extracts%>%data.frame()%>%filter(region=="Newfoundland-Labrador Shelves", rcp=="8.5"),
                           weights = cell_area)
  
  tukey.interaction_NL_8.5 <- TukeyHSD(interactions_NL, which='location')
  
  print(tukey.interaction_NL_2.6)
  print(tukey.interaction_NL_8.5)
 
# NORTHERN SHELF ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0.8638 > 0.05, so not significant, MCN doesn't matter for 2.6
  interactions_NS <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Northern Shelf", rcp=="2.6"),
                         weights = cell_area)
  
  tukey.interaction_NS_2.6 <- TukeyHSD(interactions_NS, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p = 0.9473 > 0.05, so not significant, MCN doesn't matter for 8.5
  interactions_NS <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Northern Shelf", rcp=="8.5"),
                         weights = cell_area)
  
  tukey.interaction_NS_8.5 <- TukeyHSD(interactions_NS, which='location')
  
  print(tukey.interaction_NS_2.6)
  print(tukey.interaction_NS_8.5)
  
# OFFSHORE PACIFIC ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0.7905 > 0.05, so not significant, MCN doesn't matter for 2.6
  interactions_OP <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Offshore Pacific", rcp=="2.6"),
                         weights = cell_area)
  
  tukey.interaction_OP_2.6 <- TukeyHSD(interactions_OP, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p = 0.1563 > 0.05, so not significant, MCN doesn't matter for 8.5
  interactions_OP <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Offshore Pacific", rcp=="8.5"),
                         weights = cell_area)
  
  tukey.interaction_OP_8.5 <- TukeyHSD(interactions_OP, which='location')
  
  print(tukey.interaction_OP_2.6)
  print(tukey.interaction_OP_8.5)
  
  #RCP 2.6 IN-RCP 8.5 IN - p =  > 0.05, so not significant, RCP doesn't matter for IN
  interactions_OP <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Offshore Pacific", location=="inside"),
                         weights = cell_area)
  
# SCOTIAN SHELF ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0 < 0.05, so significant (***), MCN matters for 2.6
  interactions_SS <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Scotian Shelf", rcp=="2.6"),
                         weights = cell_area)
  
  tukey.interaction_SS_2.6 <- TukeyHSD(interactions_SS, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p = 0 < 0.05, so  significant (***), MCN matters for 8.5
  interactions_SS <- aov(vuln ~ location*rcp,                                     
                         data=can_mcn_extracts%>%data.frame()%>%filter(region=="Scotian Shelf", rcp=="8.5"),
                         weights = cell_area)
  
  tukey.interaction_SS_8.5 <- TukeyHSD(interactions_SS, which='location')
  
  print(tukey.interaction_SS_2.6)
  print(tukey.interaction_SS_8.5)
  
# STRAIT OF GEORGIA  ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 0.6457 > 0.05, so not significant, MCN doesn't matter for 2.6
  interactions_SoG <- aov(vuln ~ location*rcp,                                     
                          data=can_mcn_extracts%>%data.frame()%>%filter(region=="Strait of Georgia", rcp=="2.6"),
                          weights = cell_area)
  
  tukey.interaction_SoG_2.6 <- TukeyHSD(interactions_SoG, which='location')
  
  # RCP 8.5 IN-RCP 8.5 OUT - p= 0.9485 > 0.05, so not significant, MCN doesn't matter for 8.5
  interactions_SoG <- aov(vuln ~ location*rcp,                                     
                          data=can_mcn_extracts%>%data.frame()%>%filter(region=="Strait of Georgia", rcp=="8.5"),
                          weights = cell_area)
  
  tukey.interaction_SoG_8.5 <- TukeyHSD(interactions_SoG, which='location')
  
  print(tukey.interaction_SoG_2.6)
  print(tukey.interaction_SoG_8.5)
  
# WESTERN ARCTIC ----------
  # RCP 2.6 IN-RCP 2.6 OUT - p = 2e-07 < 0.05 so significant (***), MCN matters for 2.6
     interactions_WA <- aov(vuln ~ location*rcp,                                     
                     data=can_mcn_extracts%>%data.frame()%>%filter(region=="Western Arctic", rcp=="2.6"),
                     weights = cell_area)
  
     tukey.interaction_WA_2.6 <- TukeyHSD(interactions_WA, which='location')
     
  # RCP 8.5 IN-RCP 8.5 OUT - p = 0.050 = 0.05, not significant, MCN doesn't matter for 8.5
     interactions_WA <- aov(vuln ~ location*rcp,                                     
                            data=can_mcn_extracts%>%data.frame()%>%filter(region=="Western Arctic", rcp=="8.5"),
                            weights = cell_area)
     
     tukey.interaction_WA_8.5 <- TukeyHSD(interactions_WA, which='location')
     
     print(tukey.interaction_WA_2.6)
     print(tukey.interaction_WA_8.5)
     
     
#failed loop, no clue why this doesn't work, so back to good old copy+paste for now...at least there's only 9 bioregions
     for (i in bioregions) {
       h <- aov(vuln ~ location*rcp,                                     
                               data=can_mcn_extracts%>%data.frame()%>%filter(region==i, rcp=="2.6"),
                               weights = cell_area)
       
       tukey.interaction_2.6 <- TukeyHSD(h, which='location')
       
       
       k<- aov(vuln ~ location*rcp,                                     
                               data=can_mcn_extracts%>%data.frame()%>%filter(region==i, rcp=="8.5"),
                               weights = cell_area)
       
       tukey.interaction_8.5 <- TukeyHSD(k, which='location')
       
       print(tukey.interaction_2.6, i)
       print(tukey.interaction_8.5, i)
       
     }
  